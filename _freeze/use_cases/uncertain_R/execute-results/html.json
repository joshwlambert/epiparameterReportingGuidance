{
  "hash": "4586910f5e6d9089062e6ab677d25eef",
  "result": {
    "engine": "knitr",
    "markdown": "::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# load finalsize\nlibrary(finalsize)\nlibrary(socialmixr)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'socialmixr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following object is masked from 'package:utils':\n\n    cite\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| echo: false\nlibrary(ggplot2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# get UK polymod data from socialmixr\npolymod <- socialmixr::polymod\ncontact_data <- socialmixr::contact_matrix(\n  polymod,\n  countries = \"United Kingdom\",\n  age.limits = c(0, 5, 18, 40, 65),\n  symmetric = TRUE\n)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nUsing POLYMOD social contact data. To cite this in a publication, use the 'get_citation()' function\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRemoving participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in pop_age(survey.pop, part.age.group.present, ...): Not all age groups represented in population data (5-year age band).\n  Linearly estimating age group sizes from the 5-year bands.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| echo: false\n# get the contact matrix and demography data\ncontact_matrix <- t(contact_data$matrix)\ndemography_vector <- contact_data$demography$population\n\n# scale the contact matrix so the largest eigenvalue is 1.0\ncontact_matrix <- contact_matrix / max(Re(eigen(contact_matrix)$values))\n\n# divide each row of the contact matrix by the corresponding demography\ncontact_matrix <- contact_matrix / demography_vector\n\nn_demo_grps <- length(demography_vector)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# mean R0 is 1.5\nr0_mean <- 1.5\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# susceptibility is uniform\nsusc_uniform <- matrix(\n  data = 1,\n  nrow = n_demo_grps,\n  ncol = 1L\n)\n\n# p_susceptibility is uniform\np_susc_uniform <- susc_uniform\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# create an R0 samples vector\nr0_samples <- rnorm(n = 1000, mean = r0_mean, sd = 0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n# run final size on each sample with the same data\nfinal_size_data <- Map(\n  r0_samples, seq_along(r0_samples),\n  f = function(r0, i) {\n    # the i-th final size estimate\n    fs <- final_size(\n      r0 = r0,\n      contact_matrix = contact_matrix,\n      demography_vector = demography_vector,\n      susceptibility = susc_uniform,\n      p_susceptibility = p_susc_uniform\n    )\n\n    fs$replicate <- i\n    fs$r0_estimate <- r0\n    fs\n  }\n)\n\n# combine data\nfinal_size_data <- Reduce(x = final_size_data, f = rbind)\n\n# order age groups\nfinal_size_data$demo_grp <- factor(\n  final_size_data$demo_grp,\n  levels = contact_data$demography$age.group\n)\n\n# examine some replicates in the data\nhead(final_size_data, 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   demo_grp   susc_grp susceptibility p_infected replicate r0_estimate\n1     [0,5) susc_grp_1              1  0.4378500         1    1.536741\n2    [5,18) susc_grp_1              1  0.7111826         1    1.536741\n3   [18,40) susc_grp_1              1  0.5625151         1    1.536741\n4   [40,65) susc_grp_1              1  0.4875332         1    1.536741\n5       65+ susc_grp_1              1  0.3227313         1    1.536741\n6     [0,5) susc_grp_1              1  0.4374186         2    1.535997\n7    [5,18) susc_grp_1              1  0.7107502         2    1.535997\n8   [18,40) susc_grp_1              1  0.5620324         2    1.535997\n9   [40,65) susc_grp_1              1  0.4870674         2    1.535997\n10      65+ susc_grp_1              1  0.3223626         2    1.535997\n11    [0,5) susc_grp_1              1  0.4528238         3    1.563006\n12   [5,18) susc_grp_1              1  0.7259570         3    1.563006\n13  [18,40) susc_grp_1              1  0.5791672         3    1.563006\n14  [40,65) susc_grp_1              1  0.5036707         3    1.563006\n15      65+ susc_grp_1              1  0.3355975         3    1.563006\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}